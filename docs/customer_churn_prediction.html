<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Siwei Jiang: Customer Churn Prediction</title>

  <meta property="description" itemprop="description" content="This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt&#39;s [course website](https://professor-hunt.github.io/ACC8143/){target=&quot;_blank&quot;}."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-01-18"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-01-18"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Siwei Jiang: Customer Churn Prediction"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt&#39;s [course website](https://professor-hunt.github.io/ACC8143/){target=&quot;_blank&quot;}."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Siwei Jiang"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Siwei Jiang: Customer Churn Prediction"/>
  <meta property="twitter:description" content="This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt&#39;s [course website](https://professor-hunt.github.io/ACC8143/){target=&quot;_blank&quot;}."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Customer Churn Prediction"]},{"type":"character","attributes":{},"value":["This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt's [course website](https://professor-hunt.github.io/ACC8143/){target=\"_blank\"}.\n"]},{"type":"character","attributes":{},"value":["2022-01-18"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #bdaeea;
    --header-color:    #bdaeea;
    --body-color:      #bdaeea;
    --aside-color:     #bdaeea;
    --fig-cap-color:   #eeeeee;
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   #bdaeea;
    --body-size:       0.8rem;
    --body-color:      #bdaeea;
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    20px;
    --contents-size:   14px;
    --heading-color:   #bdaeea; 
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   #bdaeea;
    --text-size:       0.8em;
    --text-color:      #bdaeea;
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       white;
    --text-size:        15px;
    --hover-color:      #fcd7f2;
    --bkgd-color:       #bdaeea;
  }

  .distill-site-footer {
    --text-color:       white;
    --text-size:        15px;
    --hover-color:      #fcd7f2;
    --bkgd-color:       #bdaeea;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below */

  /* Buttons on home page */

  .btn-outline-dark {
      background-color: #bdaeea;
      color: #fff;
      border: 0px;
  }

  .btn-outline-dark:hover {
      background-color: #bdaeea;
  }

  .panelset {
     --panel-tab-foreground: #bdaeea;
     --panel-tab-background: #aeccea;
     --panel-tab-active-foreground: #bdaeea;
     --panel-tab-active-background: #aeccea;
     --panel-tab-active-border-color: #bdaeea;
     --panel-tab-hover-foreground: #bdaeea;
     --panel-tab-hover-background: #aeccea;
     --panel-tab-hover-border-color: #aeccea;
     --panel-tab-inactive-opacity: 0.5;
     --panel-tabs-border-bottom: #ddd;
     --panel-tab-font-family: monospace;
  }

  body {
    color: #bdaeea;
  }
  h1, h2, h3 {
    color: #bdaeea;
  }

  /* unvisited link */
  a:link {
    color: #aeccea;
  }

  /* visited link */
  a:visited {
    color: #aeccea;
  }

  /* mouse over link */
  a:hover {
    color: #fcd7f2;
  }</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <link href="site_libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
  <script src="site_libs/panelset-0.2.6/panelset.js"></script>
  <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-EQGVZLTZNC"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-EQGVZLTZNC');
  </script>
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Customer Churn Prediction","description":"This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt's [course website](https://professor-hunt.github.io/ACC8143/){target=\"_blank\"}.","authors":[],"publishedDate":"2022-01-18T00:00:00.000-06:00"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo">
<img src="images/meme.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Siwei Jiang</a>
</div>
<div class="nav-right">
<a href="index.html">
<i class="fa fa-home" aria-hidden="true"></i>
</a>
<a href="https://github.com/siwei-jiang">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="change me later">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="resume.html">Resume</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Project
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="rsquared.html">Rsquared</a>
<a href="ml.html">Machine Learning</a>
<a href="customer_churn_prediction.html">Customer Churn Prediction</a>
</div>
</div>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Customer Churn Prediction</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>This report is the final project for my accounitng analysis class, and the codes are borrowed from my professor, Dr. Hunt’s <a href="https://professor-hunt.github.io/ACC8143/" target="_blank">course website</a>.</p></p>
</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#i.-about-the-data-set">I. About the data set</a></li>
<li><a href="#ii.-descriptive-stats">II. Descriptive Stats</a></li>
<li><a href="#iii.-the-models">III. The Models</a></li>
<li><a href="#iv.-the-process">IV. The Process</a></li>
<li><a href="#v.-code">V. Code</a>
<ul>
<li><a href="#i.-random-forest-total-na">i. 🎄Random Forest Total NA⭐</a></li>
<li><a href="#ii.-random-forest-na-var">ii. 🌴Random Forest NA &amp; Var🍃</a></li>
<li><a href="#iii.-random-forest-train-na">iii. Random Forest Train NA✨</a></li>
<li><a href="#iv.-random-forest-total-na-smote">iv. Random Forest Total NA &amp; SMOTE❄️</a></li>
<li><a href="#v.-gradient-boosting-tree-total-na">v. Gradient Boosting Tree Total NA</a></li>
<li><a href="#vi.-gradient-boosting-tree-train-na">vi. Gradient Boosting Tree Train NA✨</a></li>
<li><a href="#vii.-gradient-boosting-tree-total-na-smote">vii. Gradient Boosting Tree Total NA &amp; SMOTE</a></li>
<li><a href="#viii.-neural-network-total-na">viii. 🌜Neural Network Total NA🕊️</a></li>
<li><a href="#ix.-neural-network-total-na-smote">ix. Neural Network Total NA &amp; SMOTE</a></li>
</ul></li>
<li><a href="#vi.-result">VI. Result</a></li>
</ul>
</nav>
</div>
<h2 id="i.-about-the-data-set">I. About the data set</h2>
<p>I obtained this data set from Kaggle<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and Sakshi Goyal uploaded it in 2020. This data set is about a 🏦bank’s customer churn issue. The manager💼 of the bank is interested in predicting which customer will leave this bank💸. By doing so, the bank can target those customers with special products and services to increase their satisfaction and customer retention🌞.</p>
<p>It contains 10,127 observations and 23 variables. Because I had some issues with Income Category values, so I add another column that used a scale of 1 through 5 to represent each income category in Excel before importing it to the Rstudio. My data analyses are based on 20 variables, which excluded the Client Number and two Naive Bayes Classifiers😶.</p>
<p>The purpose of this project is to predict churned customers, so I use recall as an important model fit measurement📐. I also include accuracy and kappa as measurements of model fitness. I choose kappa because customer churn is only around 16% of total customers. Although some studies state kappa is not a good measure for classification model<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, I think it is good enough for this project😎 I include a comparison table📊 in the last section, Result for each models’ performance.</p>
<h2 id="ii.-descriptive-stats">II. Descriptive Stats</h2>
<p>This data set has 9,664 missing values, which is 4.77% of the 202,540 total values. Most of those missing values are belong to categorical variables.</p>
<p>After using kNN to replace all the missing data by calculating their nearest 10 neighbors 🏠🏡 values, the new data set contains 0️⃣ missing values. The distribution of the target variable is not balanced⚖️, as attrited customers only represent 16% of the total customers. Because of the potential overfitting issue, I used caret’s built-in function SMOTE oversampling to overcome this issue, and it did improved the model performance. Below are some visualizations that are used for gaining some insights of the underlying data.</p>
<aside>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>BankChurners1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/gdata/man/unknown.html'>unknownToNA</a></span><span class='op'>(</span><span class='va'>BankChurners</span>, unknown <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>""</span>, <span class='st'>"Unknown"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># summary(BankChurners1)</span>
<span class='va'>NA_cnt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>BankChurners1</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>NA_pct</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='va'>NA_cnt</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>NA_cnt</span>, <span class='va'>NA_pct</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>      NA_cnt     NA_pct
FALSE 192876 0.95228597
TRUE    9664 0.04771403</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># replace all missing values </span>
<span class='va'>BankChurners2</span> <span class='op'>&lt;-</span> <span class='fu'>VIM</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/VIM/man/kNN.html'>kNN</a></span><span class='op'>(</span><span class='va'>BankChurners1</span>, 
                          variable <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Dependent_count"</span>, <span class='st'>"Education_Level"</span>, 
                                       <span class='st'>"Marital_Status"</span>, <span class='st'>"Income_Level"</span>, 
                                       <span class='st'>"Months_Inactive_12_mon"</span>, <span class='st'>"Contacts_Count_12_mon"</span>,
                                       <span class='st'>"Total_Revolving_Bal"</span>, <span class='st'>"Total_Amt_Chng_Q4_Q1"</span>,
                                       <span class='st'>"Total_Ct_Chng_Q4_Q1"</span>, <span class='st'>"Avg_Utilization_Ratio"</span><span class='op'>)</span>,
                          k <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
<span class='va'>BankChurners2</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span>, <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>21</span><span class='op'>:</span><span class='fl'>30</span><span class='op'>)</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
 FALSE 
202540 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>NA_cnt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>
<span class='va'>NA_pct</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='va'>counts</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>NA_cnt</span>, <span class='va'>NA_pct</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>                 NA_cnt     NA_pct
ExistingCustomer   8500 0.97059671
AttritedCustomer   1627 0.02940329</code></pre>
</div>
</aside>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">Transaction Count</span> Attrited customer group has less variability and less spread regarding the total number of transactions. We can see that 50% of customer churns have less than 50 transaction counts and no of those customers have more than 100 transactions.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>BankChurners1</span>, 
       mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Attrition_Flag</span>, 
                     y <span class='op'>=</span> <span class='va'>Total_Trans_Ct</span>,
                     fill <span class='op'>=</span> <span class='va'>Attrition_Flag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Boxplot: Total Transaction Count"</span>,
       tag <span class='op'>=</span> <span class='st'>"Fig. 1"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Dark2"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/plot1-1.png" width="624" /></p>
</div>
</div>
<div class="panel">
<p><span class="panel-name">Transaction Amt💵</span> Both existing and attrited Customers are right-skewed due to outliers regarding their total transaction amounts.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>BankChurners1</span>, 
       mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Attrition_Flag</span>, 
                     y <span class='op'>=</span> <span class='va'>Total_Trans_Amt</span>,
                     fill <span class='op'>=</span> <span class='va'>Attrition_Flag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Boxplot: Total Transaction Amount"</span>,
       tag <span class='op'>=</span> <span class='st'>"Fig. 2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>"Accent"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/plot2-1.png" width="624" /></p>
</div>
</div>
<div class="panel">
<p><span class="panel-name">🌠Credit Limit</span> The majority of attrited customers have lower than $5000 credit.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>BankChurners1</span>,
       mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Credit_Limit</span>,
                     fill <span class='op'>=</span> <span class='va'>Attrition_Flag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#e9ecef"</span>, 
                 alpha <span class='op'>=</span> <span class='fl'>1</span>,
                 position <span class='op'>=</span> <span class='st'>"stack"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#adb8ff"</span>, <span class='st'>"#e8b5ff"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html'>theme_ipsum</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Histogram: Credit Limit vs Attrition"</span>,
       tag <span class='op'>=</span> <span class='st'>"Fig. 4"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/plot4-1.png" width="624" /></p>
</div>
</div>
<div class="panel">
<p><span class="panel-name">Income vs Gender</span> Females’ income levels are concentrated at low levels such as levels 1 and 2 while males have much higher income level distributions.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>BankChurners1</span>,
       mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Income_Level</span>,
                     group <span class='op'>=</span> <span class='va'>Gender</span>,
                     fill <span class='op'>=</span> <span class='va'>Gender</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>adjust <span class='op'>=</span> <span class='fl'>1.5</span>, alpha <span class='op'>=</span> <span class='fl'>.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum.html'>theme_ipsum</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Density Plot: Gender vs Income Level"</span>,
       tag <span class='op'>=</span> <span class='st'>"Fig. 3"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"M"</span><span class='op'>=</span><span class='st'>"blue"</span>, <span class='st'>"F"</span><span class='op'>=</span><span class='st'>"pink"</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># not working</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/plot3-1.png" width="624" /></p>
</div>
<aside>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>IncomeLevel</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:right;">
Income_Level
</th>
<th style="text-align:left;">
Income_Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Less than $40K
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
$40K - $60K
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
$60K - $80K
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
$80K - $120K
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
$120K +
</td>
</tr>
</tbody>
</table>
</div>
</aside>
</div>
</div>
<h2 id="iii.-the-models">III. The Models</h2>
<p>The three models used for this project are as follow:</p>
<ol type="1">
<li>Random Forest🌳: Decision trees are sensitive to changes, introducing randomness to each split of trees, reduces the over-fitting issue. Also, random forest uses bagging method to make decisions based on a majority vote from each individual tree.</li>
<li>Gradient Boosting Tree🌲: Gradient boosting is normally better💪 than random forest due to its arbitrary cost functions for classification purpose<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</li>
<li>Neural Network🔮: Neural network is very effective and efficient in making inferences and detecting patterns from complex data sets. It uses the input information to optimize the weight of those inputs and then generates outputs. It also minimizes the errors ❌ of those outputs to improve those processed inputs until the errors become small enough🔄. The final result is based on minimized errors❓</li>
</ol>
<h2 id="iv.-the-process">IV. The Process</h2>
<p>I split the data set into the training set and testing set based on 4 different ratios, and the 7:3 ratio has the best result, so I use this ratio for rest of models: 🌳random forest, gradient boosting tree🌲, and 💫neural network🔮 to train🚋 each data set. After importing the original data set, I use the kNN function with k = 10 to replace those missing values. For comparison, I replace missing values only in the training set and leave the testing set as it is. Both random forest and gradient boosting trees have better performance in terms of recall after re-sampling in the training sets. Neural network model turns out to have the worst performance. I am going to use SOMTE for the neural network model just to see the comparison. It does improved the recall quit bit even though the accuracy decreased a bit. I will update the comparsion table and the result description late.</p>
<h2 id="v.-code">V. Code</h2>
<h3 id="i.-random-forest-total-na">i. 🎄Random Forest Total NA⭐</h3>
<blockquote>
<p>Original data set with Total Missing Value Replaced</p>
</blockquote>
<p>I use 4 different ratio to split the data set into a training set and a testing set. The 7:3 ratio has the best performance. The model has 0.9661 of accuracy🎯 and 0.8683 in kappa, this huge drop probably is due to the imbalanced distribution of the attrition. The recall is 0.8381, which means that this model will misclassify 2 attrited customers of every 10 customers as existing customers.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>comparison</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.9599</span>, <span class='fl'>0.8437</span>, <span class='fl'>0.8155</span>, <span class='fl'>0.9590</span>, <span class='fl'>0.8406</span>, <span class='fl'>0.8154</span>, <span class='fl'>0.9661</span>, <span class='fl'>0.8683</span>, <span class='fl'>0.8381</span>, <span class='fl'>0.9580</span>, <span class='fl'>0.8359</span>, <span class='fl'>0.8062</span><span class='op'>)</span>,
                    ncol <span class='op'>=</span> <span class='fl'>3</span>, byrow <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Accuracy"</span>, <span class='st'>"Kappa"</span>, <span class='st'>"Recall"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"5:5"</span>, <span class='st'>"6:4"</span>, <span class='st'>"7:3"</span>, <span class='st'>"8:2"</span><span class='op'>)</span>
<span class='va'>comparison</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame.matrix</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>3</span>, color <span class='op'>=</span> <span class='st'>"white"</span>, background <span class='op'>=</span> <span class='st'>"#bdaeea"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Accuracy
</th>
<th style="text-align:right;">
Kappa
</th>
<th style="text-align:right;">
Recall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
5:5
</td>
<td style="text-align:right;">
0.9599
</td>
<td style="text-align:right;">
0.8437
</td>
<td style="text-align:right;">
0.8155
</td>
</tr>
<tr>
<td style="text-align:left;">
6:4
</td>
<td style="text-align:right;">
0.9590
</td>
<td style="text-align:right;">
0.8406
</td>
<td style="text-align:right;">
0.8154
</td>
</tr>
<tr>
<td style="text-align:left;color: white !important;background-color: #bdaeea !important;">
7:3
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.9661
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.8683
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.8381
</td>
</tr>
<tr>
<td style="text-align:left;">
8:2
</td>
<td style="text-align:right;">
0.9580
</td>
<td style="text-align:right;">
0.8359
</td>
<td style="text-align:right;">
0.8062
</td>
</tr>
</tbody>
</table>
</div>
<div class="panelset">
<div class="panel">
<p><span class="panel-name">5:5</span> Data split in 5:5 ratio.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.5</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train1</span>
<span class='va'>churn_RF1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF1</span>

<span class='co'># feature importance</span>
<span class='va'>var_imp1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>churn_RF1</span><span class='op'>)</span><span class='op'>$</span><span class='va'>importance</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>var_imp1</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Overall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total_Trans_Amt
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Trans_Ct
</td>
<td style="text-align:right;">
93.11644
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Ct_Chng_Q4_Q1
</td>
<td style="text-align:right;">
63.25446
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Relationship_Count
</td>
<td style="text-align:right;">
41.57094
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Amt_Chng_Q4_Q1
</td>
<td style="text-align:right;">
36.03208
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Revolving_Bal
</td>
<td style="text-align:right;">
32.73355
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>var_imp1</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp1</span><span class='op'>)</span>, <span class='va'>Overall</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"plum1"</span>, size <span class='op'>=</span> <span class='fl'>6</span>, alpha <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp1</span><span class='op'>)</span>, xend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp1</span><span class='op'>)</span>, 
                   y <span class='op'>=</span> <span class='fl'>0</span>, yend <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"skyblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Variable"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Overall Importance"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>  
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/RF11-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test1</span>
<span class='va'>churn_RF_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF1</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred1</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             730             4333 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result1</span>
<span class='va'>churn_matrix1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix1</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             4201              132
  AttritedCustomer               49              681
                                          
               Accuracy : 0.9643          
                 95% CI : (0.9588, 0.9692)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8617          
                                          
 Mcnemar&#39;s Test P-Value : 1.094e-09       
                                          
            Sensitivity : 0.8376          
            Specificity : 0.9885          
         Pos Pred Value : 0.9329          
         Neg Pred Value : 0.9695          
             Prevalence : 0.1606          
         Detection Rate : 0.1345          
   Detection Prevalence : 0.1442          
      Balanced Accuracy : 0.9131          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Accuracy : 0.9632  Kappa : 0.8586 Sensitivity : 0.8431</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix1</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"darkgreen"</span>, 
                       na.value <span class='op'>=</span> <span class='st'>"gray"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Random Forest Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/RF11-2.png" width="624" /></p>
</div>
</div>
<div class="panel">
<p><span class="panel-name">6:4</span> Data split in 6:4 ratio.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.6</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train1</span>
<span class='va'>churn_RF1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF1</span>

<span class='co'># test1</span>
<span class='va'>churn_RF_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF1</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred1</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># result1</span>
<span class='va'>churn_matrix1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix1</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             3354              117
  AttritedCustomer               46              533
                                          
               Accuracy : 0.9598          
                 95% CI : (0.9532, 0.9656)
    No Information Rate : 0.8395          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8437          
                                          
 Mcnemar&#39;s Test P-Value : 4.186e-08       
                                          
            Sensitivity : 0.8200          
            Specificity : 0.9865          
         Pos Pred Value : 0.9206          
         Neg Pred Value : 0.9663          
             Prevalence : 0.1605          
         Detection Rate : 0.1316          
   Detection Prevalence : 0.1430          
      Balanced Accuracy : 0.9032          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Accuracy : 0.9632  Kappa : 0.8586 Sensitivity : 0.8431</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="panel">
<p><span class="panel-name">7:3</span> Data split in 7:3 ratio.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train1</span>
<span class='va'>churn_RF1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF1</span>

<span class='co'># test1</span>
<span class='va'>churn_RF_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF1</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred1</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             444             2594 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result1</span>
<span class='va'>churn_matrix1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix1</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2519               75
  AttritedCustomer               31              413
                                          
               Accuracy : 0.9651          
                 95% CI : (0.958, 0.9713) 
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8657          
                                          
 Mcnemar&#39;s Test P-Value : 2.96e-05        
                                          
            Sensitivity : 0.8463          
            Specificity : 0.9878          
         Pos Pred Value : 0.9302          
         Neg Pred Value : 0.9711          
             Prevalence : 0.1606          
         Detection Rate : 0.1359          
   Detection Prevalence : 0.1461          
      Balanced Accuracy : 0.9171          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
</div>
</div>
<div class="panel">
<p><span class="panel-name">8:2</span> Data split in 8:2 ratio.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.8</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train1</span>
<span class='va'>churn_RF1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>

<span class='co'># test1</span>
<span class='va'>churn_RF_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF1</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred1</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred1</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># result1</span>
<span class='va'>churn_matrix1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix1</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             1683               41
  AttritedCustomer               17              284
                                          
               Accuracy : 0.9714          
                 95% CI : (0.9631, 0.9782)
    No Information Rate : 0.8395          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8904          
                                          
 Mcnemar&#39;s Test P-Value : 0.002527        
                                          
            Sensitivity : 0.8738          
            Specificity : 0.9900          
         Pos Pred Value : 0.9435          
         Neg Pred Value : 0.9762          
             Prevalence : 0.1605          
         Detection Rate : 0.1402          
   Detection Prevalence : 0.1486          
      Balanced Accuracy : 0.9319          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
</div>
</div>
</div>
<h3 id="ii.-random-forest-na-var">ii. 🌴Random Forest NA &amp; Var🍃</h3>
<blockquote>
<p>data set with 14 variables and Total Missing Value Replaced</p>
</blockquote>
<p>Education level🎓, marital status💑, card category💳, income level💰, dependent count👶, and gender👦 👩 are the least important variables that used for the final prediction. After dropping those 6 variables, the model performance decreased a little bit compared to the previous model’s.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split drop 6 var</span>
<span class='va'>BankChurners_drop_var</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>index_var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners_drop_var</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                                 p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train_var</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners_drop_var</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test_var</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners_drop_var</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train drop 6 var</span>
<span class='va'>churn_RF_var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train_var</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF_var</span>

<span class='co'># test drop 6 var</span>
<span class='va'>churn_RF_pred_var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF_var</span>, <span class='va'>test_var</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred_var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred_var</span>, <span class='va'>test_var</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred_var</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred_var</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred_var</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             299             1726 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result drop 6 var</span>
<span class='va'>churn_matrix_var</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred_var</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                    <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred_var</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                    positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix_var</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             1682               44
  AttritedCustomer               18              281
                                          
               Accuracy : 0.9694          
                 95% CI : (0.9609, 0.9764)
    No Information Rate : 0.8395          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8826          
                                          
 Mcnemar&#39;s Test P-Value : 0.001498        
                                          
            Sensitivity : 0.8646          
            Specificity : 0.9894          
         Pos Pred Value : 0.9398          
         Neg Pred Value : 0.9745          
             Prevalence : 0.1605          
         Detection Rate : 0.1388          
   Detection Prevalence : 0.1477          
      Balanced Accuracy : 0.9270          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
</div>
<h3 id="iii.-random-forest-train-na">iii. Random Forest Train NA✨</h3>
<blockquote>
<p>Original data set with Training Set Missing Value Replaced</p>
</blockquote>
<p>Only replaced missing values in the training set. The model has 0.9575 in accuracy and 0.8341 in kappa, which improved 📈 compared to the previous model. The recall is 0.8062, which means that this model will misclassify 1 attrited customer of every 10 customers as existing customers.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                              p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners1</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test2</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners1</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>train2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
 FALSE   TRUE 
154354   7686 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># replace missing values in the training set</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='fu'>VIM</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/VIM/man/kNN.html'>kNN</a></span><span class='op'>(</span><span class='va'>train2</span>, 
                   variable <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Dependent_count"</span>, <span class='st'>"Education_Level"</span>, 
                                <span class='st'>"Marital_Status"</span>, <span class='st'>"Income_Level"</span>, 
                                <span class='st'>"Months_Inactive_12_mon"</span>, <span class='st'>"Contacts_Count_12_mon"</span>,
                                <span class='st'>"Total_Revolving_Bal"</span>, <span class='st'>"Total_Amt_Chng_Q4_Q1"</span>,
                                <span class='st'>"Total_Ct_Chng_Q4_Q1"</span>, <span class='st'>"Avg_Utilization_Ratio"</span><span class='op'>)</span>,
                   k <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
<span class='co'># summary(train2)</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='va'>train2</span><span class='op'>[</span>, <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>21</span><span class='op'>:</span><span class='fl'>30</span><span class='op'>)</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>train2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
 FALSE 
162040 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># train2</span>
<span class='va'>churn_RF2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train2</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF2</span>

<span class='co'># test1</span>
<span class='va'>churn_RF_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF2</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred2</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred2</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred2</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             301             1724 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#result1</span>
<span class='va'>churn_matrix2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix2</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             1682               42
  AttritedCustomer               18              283
                                          
               Accuracy : 0.9704          
                 95% CI : (0.962, 0.9773) 
    No Information Rate : 0.8395          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8867          
                                          
 Mcnemar&#39;s Test P-Value : 0.002985        
                                          
            Sensitivity : 0.8708          
            Specificity : 0.9894          
         Pos Pred Value : 0.9402          
         Neg Pred Value : 0.9756          
             Prevalence : 0.1605          
         Detection Rate : 0.1398          
   Detection Prevalence : 0.1486          
      Balanced Accuracy : 0.9301          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix2</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"plum1"</span>, 
                       na.value <span class='op'>=</span> <span class='st'>"gray"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Random Forest Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/RF2-1.png" width="624" /></p>
</div>
<h3 id="iv.-random-forest-total-na-smote">iv. Random Forest Total NA &amp; SMOTE❄️</h3>
<blockquote>
<p>Original data set with Total Missing Value Replaced and Resampling in the Training Set</p>
</blockquote>
<p>The model has 0.9549 of accuracy and 0.8423 in kappa, which is similar to the previous model. The recall is 0.9344, the highest score among other models.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train3</span>
<span class='va'>churn_RF3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span>,
                           sampling <span class='op'>=</span> <span class='st'>"smote"</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"rf"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>
<span class='op'>)</span>
<span class='co'># churn_RF3</span>

<span class='co'># feature importance</span>
<span class='va'>var_imp3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>churn_RF3</span><span class='op'>)</span><span class='op'>$</span><span class='va'>importance</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>var_imp3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Overall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total_Trans_Ct
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Trans_Amt
</td>
<td style="text-align:right;">
71.55841
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Ct_Chng_Q4_Q1
</td>
<td style="text-align:right;">
35.62309
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Relationship_Count
</td>
<td style="text-align:right;">
26.05581
</td>
</tr>
<tr>
<td style="text-align:left;">
Months_Inactive_12_mon
</td>
<td style="text-align:right;">
19.63056
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Amt_Chng_Q4_Q1
</td>
<td style="text-align:right;">
14.54063
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>var_imp3</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp3</span><span class='op'>)</span>, <span class='va'>Overall</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"plum1"</span>, size <span class='op'>=</span> <span class='fl'>6</span>, alpha <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp3</span><span class='op'>)</span>, xend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp3</span><span class='op'>)</span>, 
                   y <span class='op'>=</span> <span class='fl'>0</span>, yend <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"skyblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Variable"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Overall Importance"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/RF3-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test3</span>
<span class='va'>churn_RF_pred3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_RF3</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_RF_pred3</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_RF_test_pred3</span> <span class='op'>&lt;-</span> <span class='va'>churn_RF_test_pred3</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred3</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             552             2486 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result3</span>
<span class='va'>churn_matrix3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred3</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_RF_test_pred3</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix3</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2448               38
  AttritedCustomer              102              450
                                          
               Accuracy : 0.9539          
                 95% CI : (0.9458, 0.9611)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8377          
                                          
 Mcnemar&#39;s Test P-Value : 1.012e-07       
                                          
            Sensitivity : 0.9221          
            Specificity : 0.9600          
         Pos Pred Value : 0.8152          
         Neg Pred Value : 0.9847          
             Prevalence : 0.1606          
         Detection Rate : 0.1481          
   Detection Prevalence : 0.1817          
      Balanced Accuracy : 0.9411          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix3</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"powderblue"</span>, 
                       na.value <span class='op'>=</span> <span class='st'>"gray"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Random Forest &amp; SMOTE Confusino Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/RF3-2.png" width="624" /></p>
</div>
<h3 id="v.-gradient-boosting-tree-total-na">v. Gradient Boosting Tree Total NA</h3>
<blockquote>
<p>Original data set with Total Missing Value Replaced</p>
</blockquote>
<p>The model has 0.9681 of accuracy and 0.8781 in kappa. The recall is 0.8648 Gradient boosting tree has a better performance compared to the random forest under the same condition.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train4</span>
<span class='va'>churn_GBM1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"gbm"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>churn_GBM1</span><span class='op'>$</span><span class='va'>bestTune</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
n.trees
</th>
<th style="text-align:right;">
interaction.depth
</th>
<th style="text-align:right;">
shrinkage
</th>
<th style="text-align:right;">
n.minobsinnode
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
60
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>churn_GBM1</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/GBM1-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test4</span>
<span class='va'>churn_GBM_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_GBM1</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_GBM_pred1</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred1</span> <span class='op'>&lt;-</span> <span class='va'>churn_GBM_test_pred1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             446             2592 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result4</span>
<span class='va'>churn_matrix4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred1</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix4</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2529               63
  AttritedCustomer               21              425
                                          
               Accuracy : 0.9724          
                 95% CI : (0.9659, 0.9779)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8938          
                                          
 Mcnemar&#39;s Test P-Value : 7.696e-06       
                                          
            Sensitivity : 0.8709          
            Specificity : 0.9918          
         Pos Pred Value : 0.9529          
         Neg Pred Value : 0.9757          
             Prevalence : 0.1606          
         Detection Rate : 0.1399          
   Detection Prevalence : 0.1468          
      Balanced Accuracy : 0.9313          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix4</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"pink"</span>,
                       na.value <span class='op'>=</span> <span class='st'>"grey"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Gradient Boosting Tree Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/GBM1-2.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># feature importance</span>
<span class='co'># summary(churn_GBM)</span>
<span class='va'>var_imp4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>churn_GBM1</span>, n.trees <span class='op'>=</span> <span class='fl'>500</span><span class='op'>)</span><span class='op'>$</span><span class='va'>importance</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>var_imp4</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Overall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total_Trans_Ct
</td>
<td style="text-align:right;">
100.00000
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Trans_Amt
</td>
<td style="text-align:right;">
86.21584
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Ct_Chng_Q4_Q1
</td>
<td style="text-align:right;">
42.17720
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Relationship_Count
</td>
<td style="text-align:right;">
34.47348
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Amt_Chng_Q4_Q1
</td>
<td style="text-align:right;">
24.89156
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Revolving_Bal
</td>
<td style="text-align:right;">
17.50240
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>var_imp4</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp4</span><span class='op'>)</span>, <span class='va'>Overall</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"violet"</span>, size <span class='op'>=</span> <span class='fl'>6</span>, alpha <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp4</span><span class='op'>)</span>, xend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp4</span><span class='op'>)</span>, 
                   y <span class='op'>=</span> <span class='fl'>0</span>, yend <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"skyblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Variable"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Overall Importance"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>  
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/GBM1-3.png" width="624" /></p>
</div>
<h3 id="vi.-gradient-boosting-tree-train-na">vi. Gradient Boosting Tree Train NA✨</h3>
<blockquote>
<p>Original data set with Training Set Missing Value Replaced and only replaced missing values in the training set</p>
</blockquote>
<p>The model has 0.9691 of accuracy and 0.8805 in kappa, and recall is 0.8545</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners1</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                              p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
 <span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners1</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
 <span class='va'>test2</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners1</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>
 <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>train2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
 FALSE   TRUE 
134991   6789 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># replace missing values in the training set</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='fu'>VIM</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/VIM/man/kNN.html'>kNN</a></span><span class='op'>(</span><span class='va'>train2</span>, 
               variable <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Dependent_count"</span>, <span class='st'>"Education_Level"</span>, 
                           <span class='st'>"Marital_Status"</span>, <span class='st'>"Income_Level"</span>, 
                           <span class='st'>"Months_Inactive_12_mon"</span>, <span class='st'>"Contacts_Count_12_mon"</span>,
                           <span class='st'>"Total_Revolving_Bal"</span>, <span class='st'>"Total_Amt_Chng_Q4_Q1"</span>,
                           <span class='st'>"Total_Ct_Chng_Q4_Q1"</span>, <span class='st'>"Avg_Utilization_Ratio"</span><span class='op'>)</span>,
              k <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
<span class='co'># summary(train2)</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='va'>train2</span><span class='op'>[</span>,<span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>21</span><span class='op'>:</span><span class='fl'>30</span><span class='op'>)</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>train2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
 FALSE 
141780 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># train5</span>
<span class='va'>churn_GBM2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train2</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"gbm"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='co'># churn_GBM2</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>churn_GBM2</span><span class='op'>$</span><span class='va'>bestTune</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
n.trees
</th>
<th style="text-align:right;">
interaction.depth
</th>
<th style="text-align:right;">
shrinkage
</th>
<th style="text-align:right;">
n.minobsinnode
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
85
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
10
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>churn_GBM2</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/GBM2-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test5</span>
<span class='va'>churn_GBM_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_GBM2</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_GBM_pred2</span>, <span class='va'>test2</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred2</span> <span class='op'>&lt;-</span> <span class='va'>churn_GBM_test_pred2</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             450             2588 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result5</span>
<span class='va'>churn_matrix5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix5</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2526               62
  AttritedCustomer               24              426
                                          
               Accuracy : 0.9717          
                 95% CI : (0.9652, 0.9773)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8916          
                                          
 Mcnemar&#39;s Test P-Value : 6.613e-05       
                                          
            Sensitivity : 0.8730          
            Specificity : 0.9906          
         Pos Pred Value : 0.9467          
         Neg Pred Value : 0.9760          
             Prevalence : 0.1606          
         Detection Rate : 0.1402          
   Detection Prevalence : 0.1481          
      Balanced Accuracy : 0.9318          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix5</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"lavender"</span>,
                       na.value <span class='op'>=</span> <span class='st'>"grey"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Gradient Boosting Tree Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/GBM2-2.png" width="624" /></p>
</div>
<h3 id="vii.-gradient-boosting-tree-total-na-smote">vii. Gradient Boosting Tree Total NA &amp; SMOTE</h3>
<blockquote>
<p>Original data set with Total Missing Value Replaced and Resampling in the Training Set</p>
</blockquote>
<p>The model has 0.9635 of accuracy and 0.8668 in kappa, which is similar to the previous result. The recall is 0.9078 🎉 (Mcnemar’s Test P-Value : 0.02545 🅿)</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data split</span>
<span class='va'>index</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span><span class='va'>BankChurners2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span>, 
                             p <span class='op'>=</span> <span class='fl'>.7</span>, list <span class='op'>=</span> <span class='cn'>FALSE</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>BankChurners2</span><span class='op'>[</span><span class='op'>-</span><span class='va'>index</span>,<span class='op'>]</span>

<span class='co'># train6</span>
<span class='va'>churn_GBM3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProbs <span class='op'>=</span> <span class='cn'>TRUE</span>,
                           sampling <span class='op'>=</span> <span class='st'>"smote"</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"gbm"</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>10</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='co'># kable(churn_GBM3$bestTune)</span>
<span class='co'># plot(churn_GBM3)</span>

<span class='co'># test6</span>
<span class='va'>churn_GBM_pred3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_GBM3</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_GBM_pred3</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_GBM_test_pred3</span> <span class='op'>&lt;-</span> <span class='va'>churn_GBM_test_pred3</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred3</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             529             2509 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result6</span>
<span class='va'>churn_matrix6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred3</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_GBM_test_pred3</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix6</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2472               37
  AttritedCustomer               78              451
                                          
               Accuracy : 0.9621          
                 95% CI : (0.9547, 0.9686)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8642          
                                          
 Mcnemar&#39;s Test P-Value : 0.0001915       
                                          
            Sensitivity : 0.9242          
            Specificity : 0.9694          
         Pos Pred Value : 0.8526          
         Neg Pred Value : 0.9853          
             Prevalence : 0.1606          
         Detection Rate : 0.1485          
   Detection Prevalence : 0.1741          
      Balanced Accuracy : 0.9468          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix6</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"firebrick"</span>,
                       na.value <span class='op'>=</span> <span class='st'>"grey"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Gradient Boosting Tree &amp; SMOTE Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/GBM3-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># feature importance</span>
<span class='co'># summary(churn_GBM)</span>
<span class='va'>var_imp5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>churn_GBM3</span>, n.trees <span class='op'>=</span> <span class='fl'>500</span><span class='op'>)</span><span class='op'>$</span><span class='va'>importance</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>var_imp5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Overall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total_Trans_Ct
</td>
<td style="text-align:right;">
100.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Trans_Amt
</td>
<td style="text-align:right;">
30.220501
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Ct_Chng_Q4_Q1
</td>
<td style="text-align:right;">
22.463371
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Relationship_Count
</td>
<td style="text-align:right;">
16.367709
</td>
</tr>
<tr>
<td style="text-align:left;">
Months_Inactive_12_mon
</td>
<td style="text-align:right;">
15.729941
</td>
</tr>
<tr>
<td style="text-align:left;">
Total_Amt_Chng_Q4_Q1
</td>
<td style="text-align:right;">
6.665217
</td>
</tr>
</tbody>
</table>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>var_imp4</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp5</span><span class='op'>)</span>, <span class='va'>Overall</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"powderblue"</span>, size <span class='op'>=</span> <span class='fl'>6</span>, alpha <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp5</span><span class='op'>)</span>, xend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>var_imp5</span><span class='op'>)</span>, 
                   y <span class='op'>=</span> <span class='fl'>0</span>, yend <span class='op'>=</span> <span class='va'>Overall</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"plum1"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Variable"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Overall Importance"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_light</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>  
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/GBM3-2.png" width="624" /></p>
</div>
<h3 id="viii.-neural-network-total-na">viii. 🌜Neural Network Total NA🕊️</h3>
<blockquote>
<p>Original data set with Total Missing Value Replaced</p>
</blockquote>
<p>The model has 0.9351 of accuracy and 0.7446 in kappa, and recall is 0.7277😕. The ROC curve looks great🏄 ROC result description: _____.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># train7</span>
<span class='va'>churn_NNET</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProb <span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"nnet"</span>,
  preProcess <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"center"</span>, <span class='st'>"scale"</span><span class='op'>)</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>5</span>,
  trace<span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>churn_NNET</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/NNET-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test7</span>
<span class='va'>churn_NNET_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_NNET</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_NNET_test_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_NNET_pred</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_NNET_test_pred</span> <span class='op'>&lt;-</span> <span class='va'>churn_NNET_test_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             430             2608 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>roc_NNET</span> <span class='op'>&lt;-</span> <span class='fu'>pROC</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pROC/man/roc.html'>roc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                      <span class='va'>churn_NNET_test_pred</span><span class='op'>$</span><span class='va'>ExistingCustomer</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>roc_NNET</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/NNET-2.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result7</span>
<span class='va'>churn_matrix7</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix7</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2470              138
  AttritedCustomer               80              350
                                          
               Accuracy : 0.9282          
                 95% CI : (0.9185, 0.9372)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.7205          
                                          
 Mcnemar&#39;s Test P-Value : 0.0001131       
                                          
            Sensitivity : 0.7172          
            Specificity : 0.9686          
         Pos Pred Value : 0.8140          
         Neg Pred Value : 0.9471          
             Prevalence : 0.1606          
         Detection Rate : 0.1152          
   Detection Prevalence : 0.1415          
      Balanced Accuracy : 0.8429          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix7</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"plum1"</span>,
                       na.value <span class='op'>=</span> <span class='st'>"grey"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Neural Network Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/NNET-3.png" width="624" /></p>
</div>
<h3 id="ix.-neural-network-total-na-smote">ix. Neural Network Total NA &amp; SMOTE</h3>
<blockquote>
<p>Original data set with total missing value replaced &amp; SMOTE resampling</p>
</blockquote>
<p>The model has _____ of accuracy and _____ in kappa, which is ______ to the previous model. The recall is _____, _____ compared to the prior model.</p>
<p>ROC result description: _____.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># train8</span>
<span class='va'>churn_NNET2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>
  form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Attrition_Flag</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>,
  data <span class='op'>=</span> <span class='va'>train</span>,
  trControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,
                           number <span class='op'>=</span> <span class='fl'>10</span>,
                           classProb <span class='op'>=</span> <span class='cn'>TRUE</span>,
                           sampling <span class='op'>=</span> <span class='st'>"smote"</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"nnet"</span>,
  preProcess <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"center"</span>, <span class='st'>"scale"</span><span class='op'>)</span>,
  tuneLength <span class='op'>=</span> <span class='fl'>5</span>,
  trace<span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>churn_NNET2</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<img src="customer_churn_prediction_files/figure-html5/NNET2-1.png" width="624" />
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># test8</span>
<span class='va'>churn_NNET_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>churn_NNET2</span>, <span class='va'>test</span>, type <span class='op'>=</span> <span class='st'>"prob"</span><span class='op'>)</span>
<span class='va'>churn_NNET_test_pred2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>churn_NNET_pred2</span>, <span class='va'>test</span><span class='op'>)</span>
<span class='va'>churn_NNET_test_pred2</span> <span class='op'>&lt;-</span> <span class='va'>churn_NNET_test_pred2</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prediction <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>AttritedCustomer</span> <span class='op'>&gt;</span> <span class='va'>ExistingCustomer</span>, 
                              <span class='st'>"AttritedCustomer"</span>, <span class='st'>"ExistingCustomer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>
AttritedCustomer ExistingCustomer 
             643             2395 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>roc_NNET</span> <span class='op'>&lt;-</span> <span class='fu'>pROC</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pROC/man/roc.html'>roc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                      <span class='va'>churn_NNET_test_pred2</span><span class='op'>$</span><span class='va'>ExistingCustomer</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>roc_NNET2</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;plot&#39;: object &#39;roc_NNET2&#39; not found</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># result8</span>
<span class='va'>churn_matrix8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred2</span><span class='op'>$</span><span class='va'>prediction</span><span class='op'>)</span>, 
                                 <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>churn_NNET_test_pred2</span><span class='op'>$</span><span class='va'>Attrition_Flag</span><span class='op'>)</span>, 
                                 positive <span class='op'>=</span> <span class='st'>"AttritedCustomer"</span><span class='op'>)</span>
<span class='va'>churn_matrix8</span>
</code></pre>
</div>
</details>
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         ExistingCustomer AttritedCustomer
  ExistingCustomer             2325               70
  AttritedCustomer              225              418
                                          
               Accuracy : 0.9029          
                 95% CI : (0.8918, 0.9132)
    No Information Rate : 0.8394          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.6809          
                                          
 Mcnemar&#39;s Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.8566          
            Specificity : 0.9118          
         Pos Pred Value : 0.6501          
         Neg Pred Value : 0.9708          
             Prevalence : 0.1606          
         Detection Rate : 0.1376          
   Detection Prevalence : 0.2117          
      Balanced Accuracy : 0.8842          
                                          
       &#39;Positive&#39; Class : AttritedCustomer
                                          </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>churn_matrix8</span><span class='op'>$</span><span class='va'>table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, fill <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Reference</span>, y <span class='op'>=</span> <span class='va'>Prediction</span>, label <span class='op'>=</span> <span class='va'>Freq</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"darkred"</span>, high <span class='op'>=</span> <span class='st'>"maroon"</span>,
                       na.value <span class='op'>=</span> <span class='st'>"grey"</span>, name <span class='op'>=</span> <span class='st'>"Freq"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Actual Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Predicted Class"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Neural Network Confusion Matrix"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>.5</span>, size <span class='op'>=</span> <span class='fl'>10</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="customer_churn_prediction_files/figure-html5/NNET2-2.png" width="624" /></p>
</div>
<h2 id="vi.-result">VI. Result</h2>
<p>Overall, 🌳random forest model has the best performance🏆 compared to gradient boosting tree and neural network🌲, especially after replacing total missing values and using SMOTE to fix 🔧 the imbalanced data set issue. (<strong>iv.RF TOTAL NA &amp; SMOTE</strong>)</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>comparison</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.9661</span>, <span class='fl'>0.8683</span>, <span class='fl'>0.8381</span>, <span class='fl'>0.9585</span>, <span class='fl'>0.8409</span>, <span class='fl'>0.8308</span>, <span class='fl'>0.9575</span>, <span class='fl'>0.8341</span>, 
                       <span class='fl'>0.8062</span>, <span class='fl'>0.9549</span>, <span class='fl'>0.8423</span>, <span class='fl'>0.9344</span>, <span class='fl'>0.9681</span>, <span class='fl'>0.8781</span>, <span class='fl'>0.8648</span>, <span class='fl'>0.9691</span>,  
                       <span class='fl'>0.8805</span>, <span class='fl'>0.8545</span>, <span class='fl'>0.9635</span>, <span class='fl'>0.8668</span>, <span class='fl'>0.9078</span>, <span class='fl'>0.9351</span>, <span class='fl'>0.7446</span>, <span class='fl'>0.7277</span>,
                       <span class='fl'>0.0000</span>, <span class='fl'>0.0000</span>, <span class='fl'>0.0000</span><span class='op'>)</span>,
                     ncol <span class='op'>=</span> <span class='fl'>3</span>, byrow <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Accuracy"</span>, <span class='st'>"Kappa"</span>, <span class='st'>"Recall"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"i.RF TOTAL NA"</span>, <span class='st'>"ii.RF TOTAL NA &amp; VAR"</span>, <span class='st'>"iii.RF TRAIN NA"</span>, 
                          <span class='st'>"iv.RF TOTAL NA &amp; SMOTE"</span>, <span class='st'>"v.GBT TOTAL NA"</span>, <span class='st'>"vi.GBT TRAIN NA"</span>, 
                          <span class='st'>"vii.GBT TOTAL NA &amp; SMOTE"</span>, <span class='st'>"viii.NNET TOTAL NA"</span>, <span class='st'>"ix.NNET TOTAL NA &amp; SMOTE"</span><span class='op'>)</span>
<span class='va'>comparison</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame.matrix</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>comparison</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/row_spec.html'>row_spec</a></span><span class='op'>(</span><span class='fl'>4</span>, color <span class='op'>=</span> <span class='st'>"white"</span>, background <span class='op'>=</span> <span class='st'>"#bdaeea"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Accuracy
</th>
<th style="text-align:right;">
Kappa
</th>
<th style="text-align:right;">
Recall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
i.RF TOTAL NA
</td>
<td style="text-align:right;">
0.9661
</td>
<td style="text-align:right;">
0.8683
</td>
<td style="text-align:right;">
0.8381
</td>
</tr>
<tr>
<td style="text-align:left;">
ii.RF TOTAL NA &amp; VAR
</td>
<td style="text-align:right;">
0.9585
</td>
<td style="text-align:right;">
0.8409
</td>
<td style="text-align:right;">
0.8308
</td>
</tr>
<tr>
<td style="text-align:left;">
iii.RF TRAIN NA
</td>
<td style="text-align:right;">
0.9575
</td>
<td style="text-align:right;">
0.8341
</td>
<td style="text-align:right;">
0.8062
</td>
</tr>
<tr>
<td style="text-align:left;color: white !important;background-color: #bdaeea !important;">
iv.RF TOTAL NA &amp; SMOTE
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.9549
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.8423
</td>
<td style="text-align:right;color: white !important;background-color: #bdaeea !important;">
0.9344
</td>
</tr>
<tr>
<td style="text-align:left;">
v.GBT TOTAL NA
</td>
<td style="text-align:right;">
0.9681
</td>
<td style="text-align:right;">
0.8781
</td>
<td style="text-align:right;">
0.8648
</td>
</tr>
<tr>
<td style="text-align:left;">
vi.GBT TRAIN NA
</td>
<td style="text-align:right;">
0.9691
</td>
<td style="text-align:right;">
0.8805
</td>
<td style="text-align:right;">
0.8545
</td>
</tr>
<tr>
<td style="text-align:left;">
vii.GBT TOTAL NA &amp; SMOTE
</td>
<td style="text-align:right;">
0.9635
</td>
<td style="text-align:right;">
0.8668
</td>
<td style="text-align:right;">
0.9078
</td>
</tr>
<tr>
<td style="text-align:left;">
viii.NNET TOTAL NA
</td>
<td style="text-align:right;">
0.9351
</td>
<td style="text-align:right;">
0.7446
</td>
<td style="text-align:right;">
0.7277
</td>
</tr>
<tr>
<td style="text-align:left;">
ix.NNET TOTAL NA &amp; SMOTE
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
</tbody>
</table>
</div>
<p>The original model from Kaggle has 0.62 for recall, so 🤠my models did improve the performance of predicting churned customers🥳. They can help companies to identify potential customer churn with higher success rate. The neural network model _____. Based on the variable importance rates, customers’ transaction numbers and amounts, changes in transaction amount, and total product held by customers are the most important⭐ predicting variables in those models. The demographic factors are not important in those models though.</p>
<p>Limitations:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://www.kaggle.com/sakshigoyal7/credit-card-customers" class="uri">https://www.kaggle.com/sakshigoyal7/credit-card-customers</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0222916" class="uri">https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0222916</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><a href="https://en.wikipedia.org/wiki/Gradient_boosting" class="uri">https://en.wikipedia.org/wiki/Gradient_boosting</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
